# План внедрения Remission

## Веха 0: Подготовка окружения
- M0.1 Зафиксировать версии Xcode и Swift, обновив раздел "Системные требования" в README.
- M0.2 Добавить конфигурации swift-format и swiftlint, согласованные с правилами команды.
- M0.3 Подключить swift-format и swiftlint к локальному hook pre-commit.
- M0.4 Настроить общие параметры сборки для целей iOS и macOS в проекте Xcode.
- Проверка: выполнить `xcodebuild -scheme Remission -destination 'platform=iOS Simulator,name=iPhone 15' build` и убедиться, что линтеры завершаются без ошибок.

## Веха 1: Основа Transmission RPC
- M1.1 Смоделировать ключевые конечные точки Transmission RPC и структуры полезной нагрузки.
- M1.2 Реализовать кодирование и декодирование запросов и ответов с переводом ошибок в тип APIError.
- M1.3 Добавить механизм рукопожатия для получения session-id и согласования версий клиента и сервера.
- M1.4 Подготовить мок-сервер для модульных тестов сетевого слоя.
- Проверка: покрыть тестами построение запросов и декодирование ответов на фиктивных данных.

## Веха 2: Безопасность и аутентификация
- M2.1 Реализовать подстановку заголовка Basic Auth в TransmissionClient.
- M2.2 Сохранить учетные данные через обертку Keychain и написать для нее модульные тесты.
- M2.3 Предоставить безопасный API управления учетными данными для верхних слоев.
- M2.4 Задокументировать требования к HTTPS/TLS и проверке сертификатов.
- Проверка: модульные тесты Keychain и smoke-тест подключения к локальному Transmission с авторизацией.

## Веха 3: Доменное ядро
- M3.1 Описать доменные модели Torrent, ServerConfig и SessionState.
- M3.2 Настроить преобразование DTO Transmission RPC в доменные модели с валидацией полей.
- M3.3 Определить протоколы репозиториев для торрентов, сессий и настроек.
- M3.4 Подготовить заглушки репозиториев для тестов UI и TCA.
- Проверка: модульные тесты репозиториев с моками TransmissionClient.

## Веха 4: Инфраструктура TCA
- M4.1 Подготовить общие утилиты (AnyScheduler, абстракции времени, контейнер зависимостей).
- M4.2 Определить типы AppState, AppAction и AppEnvironment с зависимостями.
- M4.3 Описать в документации принципы композиции редьюсеров и обработки эффектов.
- M4.4 Настроить TestStore и вспомогательные методы для тестирования редьюсеров.
- Проверка: модульные тесты базовых редьюсеров и резолвера зависимостей.

## Веха 5: Онбординг и управление серверами
- M5.1 Создать TCA-фичу онбординга (состояние, действия, редьюсер, окружение).
- M5.2 Реализовать SwiftUI-экраны ввода host, port, протокола и учетных данных.
- M5.3 Добавить проверку соединения и отображение статуса пользователю.
- M5.4 Сохранить конфигурации серверов и реализовать редактирование и удаление.
- Проверка: сквозной UI-тест онбординга и модульные тесты редьюсера.

## Веха 6: Список торрентов
- M6.1 Описать состояние списка (элементы, фильтры, сортировка, флаги загрузки) и действия в TCA.
- M6.2 Реализовать вызовы `torrent-get` с настраиваемым набором полей и обработкой ошибок.
- M6.3 Построить SwiftUI-список с индикаторами прогресса, скоростей и статуса.
- M6.4 Добавить поиск, элементы сортировки и жест pull-to-refresh, связав их с действиями.
- M6.5 Настроить периодический опрос через swift-clocks с конфигурируемым интервалом.
- Проверка: модульные тесты редьюсера (успех, ошибка, отмена) и UI-тест отображения списка.

## Веха 7: Детали торрента
- M7.1 Создать состояние деталей с файлами, трекерами, пирами и историей скоростей.
- M7.2 Получать детальные данные через репозиторий и отображать их в моделях представления.
- M7.3 Реализовать действия "Запуск", "Пауза", "Удаление", "Проверка", "Изменение приоритета".
- M7.4 Спроектировать SwiftUI-представление разделов с учетом доступности и VoiceOver.
- Проверка: модульные тесты редьюсера команд и UI-тест перехода из списка в детали.

## Веха 8: Добавление торрента
- M8.1 Реализовать обработчики импорта `.torrent` (FileImporter) и magnet-ссылок (Pasteboard/Share).
- M8.2 Добавить TCA-фичу диалога добавления торрента с параметрами (путь, старт в паузе, теги).
- M8.3 Интегрировать вызов `torrent-add` и обработку ответа Transmission.
- M8.4 Обновить список торрентов после успешного добавления.
- Проверка: модульные тесты редьюсера (валидация, отправка) и интеграционный тест с локальным Transmission.

## Веха 9: Настройки и предпочтения
- M9.1 Реализовать состояние настроек для интервала опроса, автообновления и лимитов по умолчанию.
- M9.2 Сохранить предпочтения в UserDefaults или выделенном хранилище.
- M9.3 Создать SwiftUI-контролы с группировкой настроек и описаниями.
- M9.4 Обновить редьюсеры зависимых фич для чтения выбранных настроек.
- Проверка: модульные тесты сохранения и чтения настроек и UI-тест изменения значений с проверкой персистентности.

## Веха 10: Логирование и телеметрия
- M10.1 Интегрировать swift-log с согласованными уровнями логирования.
- M10.2 Сохранять сетевые и RPC-ошибки с контекстной метаинформацией.
- M10.3 Добавить опциональный переключатель отправки телеметрии (по умолчанию отключен).
- M10.4 Подготовить гайд по чтению логов и диагностике.
- Проверка: модульные тесты форматирования логов и ручная проверка поведения переключателя.

## Веха 11: Локализация и доступность
- M11.1 Вынести пользовательские строки и добавить базовую локализацию на русском языке.
- M11.2 Подготовить англоязычную локализацию и проверить плейсхолдеры.
- M11.3 Провести аудит экранов на VoiceOver, Dynamic Type и контрастность.
- M11.4 Настроить автоматические проверки отсутствующих строк в сборке.
- Проверка: предпросмотр локализаций в Xcode, UI-тест в EN-локали и аудит с VoiceOver.

## Веха 12: Устойчивость к офлайн-режиму и ошибкам
- M12.1 Реализовать поведение при потере сети: кеш состояния и экспоненциальный повтор запросов.
- M12.2 Отображать понятные баннеры ошибок и дать возможность повторить действие.
- M12.3 Добавить экран диагностики для последних ошибок и логов.
- M12.4 Согласовать политику хранения и очистки кеша.
- Проверка: модульные тесты офлайн-сценариев и UI-тест отображения баннеров.

## Веха 13: Интеграционные испытания Transmission
- M13.1 Подготовить docker-compose сценарий для локального запуска Transmission.
- M13.2 Добавить интеграционные тесты сценариев подключения, добавления, запуска, паузы и удаления торрентов.
- M13.3 Автоматизировать поднятие и остановку Transmission через сценарий разработчика.
- M13.4 Сохранять логи и артефакты интеграционных тестов для анализа.
- Проверка: успешный локальный прогон интеграционного сценария с сохраненными артефактами.

## Веха 14: Готовность к релизу
- M14.1 Обновить документацию (README, CONTRIBUTING, AGENTS) с актуальными процессами и ссылками на PRD.
- M14.2 Сформировать заметки о релизе с фиксацией выполненных требований PRD.
- M14.3 Провести исследовательское тестирование билдов macOS и iOS.
- M14.4 Составить чек-лист для публикации в App Store/TestFlight (сертификаты, профили, метаданные).
- Проверка: подтверждения от разработчиков, QA и PM, а также успешная сборка архивов для публикации.
