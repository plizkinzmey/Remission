# Анализ больших файлов и план декомпозиции

Анализ проведен: Пятница, 23 января 2026 г.
Порог "большого файла": **300 строк**.

В ходе анализа выявлено **24 файла**, превышающих установленный лимит. Ниже приведен список наиболее критичных файлов и план по их разделению.

## 1. Список «гигантов» (> 500 строк)

| Файл | Строк | Проблема | План рефакторинга |
| :--- | :--- | :--- | :--- |
| `TorrentListView.swift` | 1003 | Содержит всю верстку списка, фильтры, хедеры, футеры и превью. | Вынести компоненты `Controls`, `Header`, `EmptyStates` в отдельные файлы в папке `Views/TorrentList/`. |
| `ServerDetailFeature.swift` | 706 | Перегружен логикой подключения, удаления и управления жизненным циклом сессии. | Вынести вспомогательные методы в `ServerDetailFeature+Connection.swift` и `ServerDetailFeature+Actions.swift`. |
| `TorrentListFeature.swift` | 570 | Основной редьюсер списка торрентов. | Вынести логику фильтрации и поиска в `TorrentListFeature+Filtering.swift`. |
| `TorrentRepository.swift` | 546 | Реализация всех методов работы с торрентами. | Разделить на расширения по группам действий (Fetch, Commands, Files). |
| `TransmissionClient.swift` | 546 | Основной сетевой клиент. | Вынести низкоуровневую работу с URLSession и маскирование в отдельные расширения. |
| `ServerSnapshotCache.swift` | 516 | Логика кэширования состояний серверов. | Разбить на логику сериализации и логику управления файловой системой. |

## 2. Файлы средней сложности (300 - 500 строк)

- **`AppDependencies.swift` (449)**: Огромное количество регистраций. Можно разбить по категориям (Network, Repositories, System).
- **`DiagnosticsView.swift` (436)**: Вынести ячейки логов в `DiagnosticsLogEntryView`.
- **`AddTorrentView.swift` (414)**: Вынести формы выбора пути и категории в под-компоненты.
- **`SettingsView.swift` (405)**: Вынести каждую секцию настроек в отдельную вьюху.
- **`TorrentRowView.swift` (325)**: После выноса `AppTagView` файл уменьшился, но можно еще вынести `RowMetrics` и `StatusBadge`.

## 3. Приоритетные действия

1.  **TorrentListView**: Декомпозиция на `TorrentListHeader`, `TorrentListFooter`, `TorrentListControls`.
2.  **ServerDetailFeature**: Очистка основного файла через расширения (Extensions).
3.  **AddTorrentView**: Разделение на логические блоки верстки.
4.  **DiagnosticsView**: Вынос логики фильтрации и отрисовки строк лога.

Цель рефакторинга: довести средний размер файла до **200-250 строк** для максимальной читаемости.
