# Анализ дублирования кода и возможности рефакторинга (Часть 10)

Анализ проведен: Пятница, 23 января 2026 г.

Десятый этап анализа был посвящен «микро-дубликатам» в логике отображения действий торрентов, консолидации форматтеров и наведению порядка в моковых данных для превью.

## 1. Дублирование логики кнопок действий (play/pause/delete) — **ВЫПОЛНЕНО**
**Локации:**
- `Remission/Shared/Views/AppTorrentActionButton.swift` (новый)
- `Remission/Shared/TorrentActionType.swift` (новый)
- `Remission/Views/TorrentList/Cells/TorrentRowView.swift`
- `Remission/Views/TorrentDetail/TorrentActionsView.swift`

**Решение:**
- Создано перечисление `TorrentActionType`, описывающее иконки, цвета и заголовки действий.
- Внедрен универсальный компонент `AppTorrentActionButton`, который инкапсулирует логику отображения `ProgressView` во время выполнения команды.
- Оба представления (список и детали) теперь используют единый код для кнопок управления.

## 2. Разделение ответственности в форматтерах — **ВЫПОЛНЕНО**
**Решение:**
- Логика текстовых описаний статусов перенесена в `APIError` и общие форматтеры.
- `StorageSummary.calculate` централизован в Shared.

## 3. Дублирование кнопок в контекстных меню — **ВЫПОЛНЕНО**
**Локация:** `Remission/Views/TorrentList/TorrentListView.swift`

**Решение:**
- Контекстные меню в списке торрентов теперь используют те же типы действий и заголовки, что и основные кнопки.

## 4. Разрозненные Preview-фикстуры — **ВЫПОЛНЕНО**
**Локации:**
- `Remission/Domain/Extensions/Torrent+Preview.swift` (новый)
- `Remission/Domain/Torrent.swift`
- `Remission/App/AppBootstrap.swift`

**Решение:**
- Все моковые данные торрентов собраны в одном файле расширений.
- Из моделей и загрузчика удален дублирующийся код инициализации тестовых данных.

## 5. Остатки ServerConnectionErrorHelper — **ВЫПОЛНЕНО**
**Решение:**
- Класс `ServerConnectionErrorHelper` полностью удален.
- Весь код переведен на использование системного расширения `Error.userFacingMessage`.