# Анализ дублирования кода и возможности рефакторинга (Часть 9)

Анализ проведен: Пятница, 23 января 2026 г.

Девятый этап анализа выявил дублирование в базовых элементах интерфейса форм и инфраструктуре управления состоянием списков.

## 1. Повторяющаяся верстка строк в формах (`fieldRow`)
**Локации:**
- `Remission/Views/Shared/ServerConnectionFormFields.swift`
- `Remission/Views/Settings/SettingsView.swift`
- `Remission/Views/TorrentAdd/AddTorrentView.swift`

**Проблема:**
В каждой крупной форме реализована собственная вспомогательная функция или структура для выравнивания метки (Label) и поля ввода (TextField). Этот «бойлерплейт» включает в себя настройку `Grid`, выравнивание по базовой линии текста и фиксированную ширину меток.

**Возможность рефакторинга:**
Создать универсальный компонент `AppLabeledField` или расширить существующий `AppLabeledValueView` для поддержки редактируемого контента, обеспечив единый отступ и стиль во всех формах приложения.

## 2. Дублирование стилей текстовых полей
**Локации:** Все формы ввода.

**Проблема:**
Код стилизации инпутов повторяется по всему проекту:
```swift
.textFieldStyle(.plain)
.padding(.horizontal, 10)
.frame(height: 32)
.appPillSurface()
```
Это затрудняет изменение визуального стиля полей ввода (например, высоты или цвета рамки) во всем приложении.

**Возможность рефакторинга:**
Создать кастомный `TextFieldStyle` (например, `AppPillTextFieldStyle`) или ViewModifier, который будет инкапсулировать всю логику оформления инпута.

## 3. Разрозненная логика фильтрации ввода
**Локации:**
- `ServerConnectionFormFields.swift` (метод `filterASCII`)
- `SettingsReducer.swift` (логика парсинга чисел и Ratio)

**Проблема:**
Логика, ограничивающая ввод пользователя (только цифры, только ASCII, удаление пробелов), реализована локально в редьюсерах или вьюхах через ручные проверки.

**Возможность рефакторинга:**
Вынести правила фильтрации в расширение `Binding<String>` или создать набор пресетов `InputFilter` (numeric, host, alphanumeric), которые можно применять одной строкой.

## 4. Идентичные паттерны «Загрузка — Пусто — Список»
**Локации:**
- `ServerListView.swift`
- `TorrentListView.swift`

**Проблема:**
Оба основных экрана приложения реализуют одинаковую логику переключения между `ProgressView` (загрузка), `EmptyPlaceholderView` (нет данных) и основным контентом. Код условий (`if isLoading { ... } else if items.isEmpty { ... }`) практически идентичен.

**Возможность рефакторинга:**
Создать `AppListContainer`, который будет принимать текущую фазу загрузки и замыкания для отрисовки каждого из состояний, минимизируя вложенность в основных вьюхах.

## 5. Дублирование логики выбора пути (Path)
**Локации:**
- Форма настройки сервера (`connection.path`)
- Экран добавления торрента (`destinationPath`)

**Проблема:**
Несмотря на наличие утилиты `TransmissionPathNormalization`, интерфейс ввода пути (с подсказками последних директорий или стандартных путей) реализован по-разному.

**Возможность рефакторинга:**
Создать компонент `AppPathField`, который будет поддерживать ввод текста и выпадающее меню с историей/подсказками, унифицировав UX работы с файловой системой Transmission.
